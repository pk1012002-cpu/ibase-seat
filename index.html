<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>127桌座位圖（依照指定配置）</title>
  <style>
    :root{
      --border:#cfcfcf;
      --text:#222;
      --muted:#666;
      --accent:#2563eb;
      --seatFill:#ffffff;
      --seatStroke:#444;
      --aisle:#efefef;
      --stage:#f6c200;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",sans-serif;
      color:var(--text);
      background:#fafafa;
    }
    header{
      max-width:1200px;
      margin:0 auto;
      padding:16px 16px 8px;
    }
    h1{ margin:0 0 10px; font-size:18px; }
    .toolbar{
      display:grid;
      grid-template-columns:1fr auto auto;
      gap:10px;
      align-items:center;
    }
    input{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(37,99,235,.15);
    }
    button{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-size:14px;
    }
    button:hover{ background:#f5f5f5; }
    .hint{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
    }

    main{ max-width:1200px; margin:0 auto; padding:8px 16px 24px; }
    .frame{
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px;
      overflow:auto;
    }
    svg{ width:100%; height:auto; min-width:980px; }

    /* SVG 樣式 */
    .seat circle{
      fill: var(--seatFill);
      stroke: var(--seatStroke);
      stroke-width: 2;
    }
    .seat text{
      font-size: 14px;
      font-weight: 700;
      text-anchor: middle;
      dominant-baseline: middle;
      fill:#111;
      pointer-events:none;
    }
    .seat.big text{ font-size: 15px; }
    .seat.hit circle{
      stroke: var(--accent);
      stroke-width: 4;
      filter: drop-shadow(0 0 6px rgba(37,99,235,.35));
    }
    .label{
      font-size:14px;
      fill:#333;
      font-weight:700;
    }
    .label.muted{ fill:#666; font-weight:600; font-size:13px; }
    .aisle{
      fill: var(--aisle);
      stroke: #d0d0d0;
      stroke-width: 1.5;
      rx: 8;
    }
    .stage{
      fill: var(--stage);
      stroke: #caa000;
      stroke-width: 2;
      rx: 10;
    }
    .outer{
      fill:none;
      stroke:#777;
      stroke-width:2;
      rx:14;
    }
  </style>
</head>
<body>
<header>
  <h1>座位圖（127桌）</h1>
  <div class="toolbar">
    <input id="q" type="text" placeholder="搜尋桌號：127、20-35、3,8,9…" />
    <button id="btnSearch" type="button">搜尋</button>
    <button id="btnReset" type="button">重設</button>
  </div>
  <div class="hint">
    已依照你提供的圖：黃底舞台＋兩條「升降星光大道」＋中區桌位間距加大。點選桌號也會高亮。
  </div>
</header>

<main>
  <div class="frame">
    <svg id="map" viewBox="0 0 1000 520" role="img" aria-label="127桌座位圖">
      <!-- 外框（示意） -->
      <rect class="outer" x="20" y="20" width="960" height="480"></rect>

      <!-- 舞台（黃底） -->
      <rect class="stage" x="380" y="80" width="240" height="90"></rect>
      <text class="label" x="500" y="125">舞台</text>

      <!-- 兩條升降星光大道（直向走道） -->
      <rect class="aisle" x="320" y="150" width="55" height="300"></rect>
      <text class="label muted" x="347.5" y="310" transform="rotate(-90 347.5 310)">升降星光大道</text>

      <rect class="aisle" x="675" y="150" width="55" height="300"></rect>
      <text class="label muted" x="702.5" y="310" transform="rotate(-90 702.5 310)">升降星光大道</text>

      <!-- 群組容器：座位會由 JS 產生 -->
      <g id="seats"></g>
    </svg>
  </div>
</main>

<script>
  // ============ 座位資料（依照圖的相對位置手動定位） ============
  // 座標系：viewBox 1000x520
  // r: 半徑（一般 18，大圈 20）
  const seats = [];

  function add(no, x, y, r=18){
    seats.push({ no: String(no), x, y, r });
  }

  // ----- 左區 (52-89) + 53 (大) + 52 (單顆) -----
  add(52, 95, 140, 18);
  add(53, 225, 140, 20); // 大圈

  // 左區 54-89：4欄 x=[95,150,205,260], y 從 190 到 465
  const lx = [95,150,205,260];
  const ly = [190,235,280,325,370,415,460]; // 7排 * 4 = 28 (54-81) + 再加兩排補到 89
  // 依圖：54/55 在第一排左二，56/57 在第一排右二，以此類推（每排4顆）
  let n = 54;
  const leftRows = [
    [54,55,56,57],
    [58,59,60,61],
    [62,63,64,65],
    [66,67,68,69],
    [70,71,72,73],
    [74,75,76,77],
    [78,79,80,81],
    [82,83,84,85],
    [86,87,88,89]
  ];
  const leftY = [190,235,280,325,370,415,460,505,550]; // 但超出外框，改用較緊的 9 排
  // 重新用 9 排 within 480： y 取 180..470
  const leftY2 = [190,225,260,295,330,365,400,435,470];
  for (let i=0;i<leftRows.length;i++){
    for (let j=0;j<4;j++){
      add(leftRows[i][j], lx[j], leftY2[i], 18);
    }
  }

  // ----- 左中直列 (42-51)，42 為大圈 -----
  add(42, 410, 140, 20); // 大圈
  const col42to51 = [43,44,45,46,47,48,49,50,51];
  const cy = [190,225,260,295,330,365,400,435,470];
  for (let i=0;i<col42to51.length;i++){
    add(col42to51[i], 410, cy[i], 18);
  }

  // ----- 中區 (主桌1-5 以 1-5 表示、其餘 6-41 + 右側直列 11/18/19/26/33/40 + 127) -----
  // 主桌 1~5（位置在舞台下方一排，與圖一致）
  add(1, 450, 235, 18);
  add(2, 510, 235, 18);
  add(3, 570, 235, 18);
  add(4, 630, 235, 18);
  add(5, 690, 235, 18);

  // 127（福）與 6 在右側走道上方
  add(127, 705, 135, 20);
  add(6,   705, 210, 18);

  // 右側直列（靠走道內側）：11 / 18 / 19 / 26 / 33 / 40
  const rightCol = [
    {no:11, y:270},
    {no:18, y:320},
    {no:19, y:360},
    {no:26, y:410},
    {no:33, y:460},
    {no:40, y:505} // 會在外框外，稍微上移
  ];
  rightCol.forEach(o => add(o.no, 705, Math.min(o.y, 470), 18));

  // 中間桌位（加大間距）：7-10、12-17、20-25、27-32、34-39、41
  // 7-10
  add(7, 455, 290, 18);
  add(8, 505, 290, 18);
  add(9, 605, 290, 18);
  add(10,655, 290, 18);

  // 12-17（六顆）
  const row12 = [12,13,14,15,16,17];
  const x12 = [455,505,555,605,655,705-55]; // 最後一顆靠近走道前留距
  const y12 = 340;
  for (let i=0;i<row12.length;i++){
    add(row12[i], x12[i], y12, 18);
  }

  // 20-25
  const row20 = [20,21,22,23,24,25];
  const x20 = [455,505,555,605,655,705-55];
  const y20 = 390;
  for (let i=0;i<row20.length;i++){
    add(row20[i], x20[i], y20, 18);
  }

  // 27-32
  const row27 = [27,28,29,30,31,32];
  const x27 = [455,505,555,605,655,705-55];
  const y27 = 440;
  for (let i=0;i<row27.length;i++){
    add(row27[i], x27[i], y27, 18);
  }

  // 34-39
  const row34 = [34,35,36,37,38,39];
  const x34 = [455,505,555,605,655,705-55];
  const y34 = 485; // 底部再留一點
  for (let i=0;i<row34.length;i++){
    add(row34[i], x34[i], y34, 18);
  }

  // 41（底部中間）
  add(41, 560, 505, 18); // 稍微靠下，仍在外框內（看起來像你圖）

  // ----- 右區 (90-126) -----
  add(90, 905, 140, 18);
  const rx = [845,890,935,980-20]; // 右側靠邊縮一點
  const ry = [190,225,260,295,330,365,400,435,470];
  const rightRows = [
    [91,92,93,94],
    [95,96,97,98],
    [99,100,101,102],
    [103,104,105,106],
    [107,108,109,110],
    [111,112,113,114],
    [115,116,117,118],
    [119,120,121,122],
    [123,124,125,126]
  ];
  for (let i=0;i<rightRows.length;i++){
    for (let j=0;j<4;j++){
      add(rightRows[i][j], rx[j], ry[i], 18);
    }
  }

  // ============ 渲染 SVG 座位 ============
  const seatsG = document.getElementById("seats");

  function seatEl(s){
    const g = document.createElementNS("http://www.w3.org/2000/svg","g");
    g.setAttribute("class", "seat" + (s.r>=20 ? " big" : ""));
    g.dataset.no = s.no;

    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx", s.x);
    c.setAttribute("cy", s.y);
    c.setAttribute("r", s.r);

    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x", s.x);
    t.setAttribute("y", s.y);
    t.textContent = s.no;

    g.appendChild(c);
    g.appendChild(t);

    g.addEventListener("click", () => {
      clearMarks();
      g.classList.add("hit");
      // 捲到視野中央
      g.scrollIntoView({behavior:"smooth", block:"center", inline:"center"});
    });

    return g;
  }

  seats.forEach(s => seatsG.appendChild(seatEl(s)));

  // ============ 搜尋 ============
  const q = document.getElementById("q");
  const btnSearch = document.getElementById("btnSearch");
  const btnReset = document.getElementById("btnReset");

  function parseQueryToNos(text){
    const t = text.trim();
    if (!t) return null;

    if (t.includes(",")){
      const nums = t.split(",")
        .map(x=>x.trim()).filter(Boolean)
        .map(x=>Number(x)).filter(n=>Number.isFinite(n))
        .map(n=>String(n));
      return nums.length ? Array.from(new Set(nums)) : null;
    }

    const m = t.match(/^(\d+)\s*-\s*(\d+)$/);
    if (m){
      const a = Number(m[1]), b = Number(m[2]);
      const lo = Math.min(a,b), hi = Math.max(a,b);
      const arr = [];
      for (let x=lo; x<=hi; x++) arr.push(String(x));
      return arr;
    }

    if (/^\d+$/.test(t)) return [String(Number(t))];
    return null;
  }

  function clearMarks(){
    document.querySelectorAll(".seat").forEach(el => el.classList.remove("hit"));
  }

  function applySearch(){
    const text = q.value.trim();
    clearMarks();
    if (!text) return;

    const nos = parseQueryToNos(text);
    const needle = text.toLowerCase();

    let first = null;
    document.querySelectorAll(".seat").forEach(el => {
      const no = el.dataset.no;
      let hit = false;

      if (nos && nos.includes(no)) hit = true;
      // 這版主要用桌號；仍保留文字匹配（輸入 "福" 也可找 127）
      if (!hit && (no.includes(needle) || (needle === "福" && no === "127"))) hit = true;

      if (hit){
        el.classList.add("hit");
        if (!first) first = el;
      }
    });

    if (first) first.scrollIntoView({behavior:"smooth", block:"center", inline:"center"});
  }

  btnSearch.addEventListener("click", applySearch);
  q.addEventListener("keydown", (e)=>{ if(e.key==="Enter") applySearch(); });
  btnReset.addEventListener("click", ()=>{ q.value=""; clearMarks(); });
</script>
</body>
</html>
