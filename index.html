<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>127æ¡Œåº§ä½åœ–ï¼ˆä¾ç…§æŒ‡å®šé…ç½®ï¼‰</title>
  <style>
    :root{
      --border:#cfcfcf;
      --text:#222;
      --muted:#666;
      --accent:#2563eb;
      --seatFill:#ffffff;
      --seatStroke:#444;
      --aisle:#efefef;
      --stage:#f6c200;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",sans-serif;
      color:var(--text);
      background:#fafafa;
    }
    header{
      max-width:1200px;
      margin:0 auto;
      padding:16px 16px 8px;
    }
    h1{ margin:0 0 10px; font-size:18px; }
    .toolbar{
      display:grid;
      grid-template-columns:1fr auto auto;
      gap:10px;
      align-items:center;
    }
    input{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(37,99,235,.15);
    }
    button{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-size:14px;
    }
    button:hover{ background:#f5f5f5; }
    .hint{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
    }

    main{ max-width:1200px; margin:0 auto; padding:8px 16px 24px; }
    .frame{
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px;
      overflow:auto;
    }
    svg{ width:100%; height:auto; min-width:980px; }

    /* SVG æ¨£å¼ */
    .seat circle{
      fill: var(--seatFill);
      stroke: var(--seatStroke);
      stroke-width: 2;
    }
    .seat text{
      font-size: 14px;
      font-weight: 700;
      text-anchor: middle;
      dominant-baseline: middle;
      fill:#111;
      pointer-events:none;
    }
    .seat.big text{ font-size: 15px; }
    .seat.hit circle{
      stroke: var(--accent);
      stroke-width: 4;
      filter: drop-shadow(0 0 6px rgba(37,99,235,.35));
    }
	
    .label{
      font-size:14px;
      fill:#333;
      font-weight:700;
    }
    .label.muted{ fill:#666; font-weight:600; font-size:13px; }
    .aisle{
      fill: var(--aisle);
      stroke: #d0d0d0;
      stroke-width: 1.5;
      rx: 8;
    }
    .stage{
      fill: var(--stage);
      stroke: #caa000;
      stroke-width: 2;
      rx: 10;
    }
    .outer{
      fill:none;
      stroke:#777;
      stroke-width:2;
      rx:14;
    }
	/* âœ… å–æ¶ˆ SVG é»æ“Šå¾Œçš„è—è‰² focus å¤–æ¡† */
	.seat, .seat:focus, .seat:focus-visible,
	svg g:focus, svg g:focus-visible,
	svg circle:focus, svg circle:focus-visible,
	svg text:focus, svg text:focus-visible {
	  outline: none !important;
	}
	
  </style>
</head>
<body>
<header>
  <h1>åº§ä½åœ–ï¼ˆ127æ¡Œï¼‰</h1>
  <div class="toolbar">
    <input id="q" type="text" placeholder="æœå°‹æ¡Œè™Ÿï¼š127ã€20-35ã€3,8,9â€¦" />
    <button id="btnSearch" type="button">æœå°‹</button>
    <button id="btnReset" type="button">é‡è¨­</button>
  </div>
  <div class="hint">
    å·²ä¾ç…§ä½ æä¾›çš„åœ–ï¼šé»ƒåº•èˆå°ï¼‹å…©æ¢ã€Œå‡é™æ˜Ÿå…‰å¤§é“ã€ï¼‹ä¸­å€æ¡Œä½é–“è·åŠ å¤§ã€‚é»é¸æ¡Œè™Ÿä¹Ÿæœƒé«˜äº®ã€‚
  </div>
</header>

<main>
	<div id="infoBox" style="
	  background:#fff;
	  border:1px solid #cfcfcf;
	  border-radius:14px;
	  padding:12px 14px;
	  margin-bottom:10px;
	  font-size:14px;
	">
	  <div style="font-weight:800; margin-bottom:6px;">å°šæœªé¸æ“‡æ¡Œä½</div>
	  <div style="color:#666; font-size:13px;">è«‹é»é¸æ¡Œä½é¡¯ç¤ºæ¡Œè™Ÿèˆ‡äººåã€‚</div>
	</div>

  <div class="frame">
    <svg id="map" viewBox="0 0 1000 520" role="img" aria-label="127æ¡Œåº§ä½åœ–">
      <!-- å¤–æ¡†ï¼ˆç¤ºæ„ï¼‰ -->
      <rect class="outer" x="20" y="20" width="960" height="480"></rect>

      <!-- èˆå°ï¼ˆé»ƒåº•ï¼‰ -->
      <rect class="stage" x="380" y="80" width="240" height="90"></rect>
      <text class="label" x="500" y="125">èˆå°</text>

      <!-- å…©æ¢å‡é™æ˜Ÿå…‰å¤§é“ï¼ˆç›´å‘èµ°é“ï¼‰ -->
      <rect class="aisle" x="320" y="150" width="55" height="300"></rect>
      <text class="label muted" x="347.5" y="310" transform="rotate(-90 347.5 310)">å‡é™æ˜Ÿå…‰å¤§é“</text>

      <rect class="aisle" x="675" y="150" width="55" height="300"></rect>
      <text class="label muted" x="702.5" y="310" transform="rotate(-90 702.5 310)">å‡é™æ˜Ÿå…‰å¤§é“</text>

      <!-- ç¾¤çµ„å®¹å™¨ï¼šåº§ä½æœƒç”± JS ç”¢ç”Ÿ -->
      <g id="seats"></g>
    </svg>
  </div>
</main>

<script>
  // ============ åº§ä½è³‡æ–™ï¼ˆä¾ç…§åœ–çš„ç›¸å°ä½ç½®æ‰‹å‹•å®šä½ï¼‰ ============
	/* ===== æ¯æ¡Œ 10 å€‹äººå ===== */
	const seatNames = {
	  "20": [
		"Charlie","é™³ç¾éº—","æ—å¿—è±ª","é»ƒæ€¡å›","å¼µå®¶è±ª",
		"Alice","è¨±å‹å‚‘","éƒ­é›…é›¯","å‘¨å“å¦¤","è”¡å®—ç¿°"
	  ],
	  "21": [
		"Alice","Bob","é™³ç¾éº—","David","Eve",
		"Frank","Grace","Heidi","Ivan","Judy"
	  ],
	  "127": [
		"è‘£äº‹é•·","ç¸½ç¶“ç†","å‰¯ç¸½A","å‰¯ç¸½B","è²´è³“ä¸€",
		"è²´è³“äºŒ","è²´è³“ä¸‰","è²´è³“å››","è²´è³“äº”","è²´è³“å…­"
	  ]
	};

	/* æ²’è¨­å®šåå–®çš„æ¡Œï¼Œå›å‚³ç©ºé™£åˆ— */
	function getNames(no){
	  return seatNames[String(no)] || [];
	}
  
  // åº§æ¨™ç³»ï¼šviewBox 1000x520
  // r: åŠå¾‘ï¼ˆä¸€èˆ¬ 18ï¼Œå¤§åœˆ 20ï¼‰
	const seats = [];

	/* è‡ªå‹•ä¾æ¡Œè™Ÿå¸¶å…¥ 10 å€‹äººå */
	function add(no, x, y, r=18){
	  seats.push({
		no: String(no),
		x, y, r,
		names: getNames(no)   // ğŸ‘ˆ é—œéµ
	  });
	}
	
  // ----- å·¦å€ (52-89) + 53 (å¤§) + 52 (å–®é¡†) -----
  add(52, 95, 140, 18);
  add(53, 225, 140, 20); // å¤§åœˆ

  // å·¦å€ 54-89ï¼š4æ¬„ x=[95,150,205,260], y å¾ 190 åˆ° 465
  const lx = [95,150,205,260];
  const ly = [190,235,280,325,370,415,460]; // 7æ’ * 4 = 28 (54-81) + å†åŠ å…©æ’è£œåˆ° 89
  // ä¾åœ–ï¼š54/55 åœ¨ç¬¬ä¸€æ’å·¦äºŒï¼Œ56/57 åœ¨ç¬¬ä¸€æ’å³äºŒï¼Œä»¥æ­¤é¡æ¨ï¼ˆæ¯æ’4é¡†ï¼‰
  let n = 54;
  const leftRows = [
    [54,55,56,57],
    [58,59,60,61],
    [62,63,64,65],
    [66,67,68,69],
    [70,71,72,73],
    [74,75,76,77],
    [78,79,80,81],
    [82,83,84,85],
    [86,87,88,89]
  ];
  const leftY = [190,235,280,325,370,415,460,505,550]; // ä½†è¶…å‡ºå¤–æ¡†ï¼Œæ”¹ç”¨è¼ƒç·Šçš„ 9 æ’
  // é‡æ–°ç”¨ 9 æ’ within 480ï¼š y å– 180..470
  const leftY2 = [190,225,260,295,330,365,400,435,470];
  for (let i=0;i<leftRows.length;i++){
    for (let j=0;j<4;j++){
      add(leftRows[i][j], lx[j], leftY2[i], 18);
    }
  }

  // ----- å·¦ä¸­ç›´åˆ— (42-51)ï¼Œ42 ç‚ºå¤§åœˆ -----
  add(42, 410, 140, 20); // å¤§åœˆ
  const col42to51 = [43,44,45,46,47,48,49,50,51];
  const cy = [190,225,260,295,330,365,400,435,470];
  for (let i=0;i<col42to51.length;i++){
    add(col42to51[i], 410, cy[i], 18);
  }

  // ----- ä¸­å€ (ä¸»æ¡Œ1-5 ä»¥ 1-5 è¡¨ç¤ºã€å…¶é¤˜ 6-41 + å³å´ç›´åˆ— 11/18/19/26/33/40 + 127) -----
  // ä¸»æ¡Œ 1~5ï¼ˆä½ç½®åœ¨èˆå°ä¸‹æ–¹ä¸€æ’ï¼Œèˆ‡åœ–ä¸€è‡´ï¼‰
  add(1, 450, 235, 18);
  add(2, 510, 235, 18);
  add(3, 570, 235, 18);
  add(4, 630, 235, 18);
  add(5, 690, 235, 18);

  // 127ï¼ˆç¦ï¼‰èˆ‡ 6 åœ¨å³å´èµ°é“ä¸Šæ–¹
  add(127, 705, 135, 20);
  add(6,   705, 210, 18);

  // å³å´ç›´åˆ—ï¼ˆé èµ°é“å…§å´ï¼‰ï¼š11 / 18 / 19 / 26 / 33 / 40
  const rightCol = [
    {no:11, y:270},
    {no:18, y:320},
    {no:19, y:360},
    {no:26, y:410},
    {no:33, y:460},
    {no:40, y:505} // æœƒåœ¨å¤–æ¡†å¤–ï¼Œç¨å¾®ä¸Šç§»
  ];
  rightCol.forEach(o => add(o.no, 705, Math.min(o.y, 470), 18));

  // ä¸­é–“æ¡Œä½ï¼ˆåŠ å¤§é–“è·ï¼‰ï¼š7-10ã€12-17ã€20-25ã€27-32ã€34-39ã€41
  // 7-10
  add(7, 455, 290, 18);
  add(8, 505, 290, 18);
  add(9, 605, 290, 18);
  add(10,655, 290, 18);

  // 12-17ï¼ˆå…­é¡†ï¼‰
  const row12 = [12,13,14,15,16,17];
  const x12 = [455,505,555,605,655,705-55]; // æœ€å¾Œä¸€é¡†é è¿‘èµ°é“å‰ç•™è·
  const y12 = 340;
  for (let i=0;i<row12.length;i++){
    add(row12[i], x12[i], y12, 18);
  }

  // 20-25
  const row20 = [20,21,22,23,24,25];
  const x20 = [455,505,555,605,655,705-55];
  const y20 = 390;
  for (let i=0;i<row20.length;i++){
    add(row20[i], x20[i], y20, 18);
  }

  // 27-32
  const row27 = [27,28,29,30,31,32];
  const x27 = [455,505,555,605,655,705-55];
  const y27 = 440;
  for (let i=0;i<row27.length;i++){
    add(row27[i], x27[i], y27, 18);
  }

  // 34-39
  const row34 = [34,35,36,37,38,39];
  const x34 = [455,505,555,605,655,705-55];
  const y34 = 485; // åº•éƒ¨å†ç•™ä¸€é»
  for (let i=0;i<row34.length;i++){
    add(row34[i], x34[i], y34, 18);
  }

  // 41ï¼ˆåº•éƒ¨ä¸­é–“ï¼‰
  add(41, 560, 505, 18); // ç¨å¾®é ä¸‹ï¼Œä»åœ¨å¤–æ¡†å…§ï¼ˆçœ‹èµ·ä¾†åƒä½ åœ–ï¼‰

  // ----- å³å€ (90-126) -----
  add(90, 905, 140, 18);
  const rx = [845,890,935,980-20]; // å³å´é é‚Šç¸®ä¸€é»
  const ry = [190,225,260,295,330,365,400,435,470];
  const rightRows = [
    [91,92,93,94],
    [95,96,97,98],
    [99,100,101,102],
    [103,104,105,106],
    [107,108,109,110],
    [111,112,113,114],
    [115,116,117,118],
    [119,120,121,122],
    [123,124,125,126]
  ];
  for (let i=0;i<rightRows.length;i++){
    for (let j=0;j<4;j++){
      add(rightRows[i][j], rx[j], ry[i], 18);
    }
  }
	  
	// âœ… ä¾æ¡Œè™Ÿæ‰¾åˆ° seats è£¡çš„è³‡æ–™ï¼ˆåŒ…å« namesï¼‰
	function findSeat(no){
	  return seats.find(s => s.no === String(no));
	}

	// âœ… æ›´æ–°å³å´/ä¸Šæ–¹è³‡è¨Šé¢æ¿
	function showSeatInfo(no){
	  const box = document.getElementById("infoBox");
	  const seat = findSeat(no);

	  if (!box) return;

	  if (!seat){
		box.innerHTML = `
		  <div style="font-weight:800; margin-bottom:6px;">æ‰¾ä¸åˆ°æ¡Œä½ï¼š${no}</div>
		`;
		return;
	  }

	  const names = (seat.names && seat.names.length) ? seat.names : ["ï¼ˆæ­¤æ¡Œå°šæœªè¨­å®šäººåï¼‰"];
	  const list = names.map(n => `<li style="margin:2px 0;">${n}</li>`).join("");

	  box.innerHTML = `
		<div style="display:flex; align-items:center; gap:10px; margin-bottom:6px;">
		  <div style="font-weight:900; font-size:16px;">æ¡Œè™Ÿï¼š${seat.no}</div>
		  <div style="color:#666; font-size:13px;">å…± ${seat.names.length} äºº</div>
		</div>
		<ol style="margin:0; padding-left:18px;">
		  ${list}
		</ol>
	  `;
	}

  // ============ æ¸²æŸ“ SVG åº§ä½ ============
  const seatsG = document.getElementById("seats");

  function seatEl(s){
    const g = document.createElementNS("http://www.w3.org/2000/svg","g");
    g.setAttribute("class", "seat" + (s.r>=20 ? " big" : ""));
    g.dataset.no = s.no;

	g.dataset.names = (s.names || []).join(" ").toLowerCase();
	g.setAttribute("tabindex", "-1"); // âœ… ä¸è®“ g è¢« focus

    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx", s.x);
    c.setAttribute("cy", s.y);
    c.setAttribute("r", s.r);

    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x", s.x);
    t.setAttribute("y", s.y);
    t.textContent = s.no;

    g.appendChild(c);
    g.appendChild(t);

    g.addEventListener("click", () => {
      clearMarks();
      g.classList.add("hit");

	//showSeatInfo(s.no);
      // æ²åˆ°è¦–é‡ä¸­å¤®
      g.scrollIntoView({behavior:"smooth", block:"center", inline:"center"});
    });

    return g;
  }
  
  seats.forEach(s => seatsG.appendChild(seatEl(s)));

  // ============ æœå°‹ ============
  const q = document.getElementById("q");
  const btnSearch = document.getElementById("btnSearch");
  const btnReset = document.getElementById("btnReset");

  function parseQueryToNos(text){
    const t = text.trim();
    if (!t) return null;

    if (t.includes(",")){
      const nums = t.split(",")
        .map(x=>x.trim()).filter(Boolean)
        .map(x=>Number(x)).filter(n=>Number.isFinite(n))
        .map(n=>String(n));
      return nums.length ? Array.from(new Set(nums)) : null;
    }

    const m = t.match(/^(\d+)\s*-\s*(\d+)$/);
    if (m){
      const a = Number(m[1]), b = Number(m[2]);
      const lo = Math.min(a,b), hi = Math.max(a,b);
      const arr = [];
      for (let x=lo; x<=hi; x++) arr.push(String(x));
      return arr;
    }

    if (/^\d+$/.test(t)) return [String(Number(t))];
    return null;
  }

  function clearMarks(){
    document.querySelectorAll(".seat").forEach(el => el.classList.remove("hit"));
  }

	function applySearch(){
	  const text = q.value.trim();
	  clearMarks();
	  if (!text) return;

	  const nos = parseQueryToNos(text);   // æ¡Œè™Ÿ / ç¯„åœ
	  const needle = text.toLowerCase();   // å§“åé—œéµå­—

	  let first = null;
	  document.querySelectorAll(".seat").forEach(el => {
		const no = el.dataset.no;
		const names = el.dataset.names || "";
		let hit = false;

		// 1ï¸âƒ£ æ¡Œè™Ÿæœå°‹ï¼ˆ20ã€20-25ã€3,8,9ï¼‰
		if (nos && nos.includes(no)) hit = true;

		// 2ï¸âƒ£ å§“åæœå°‹ï¼ˆç‹å°æ˜ / å°æ˜ / aliceï¼‰
		if (!hit && !nos && names.includes(needle)) hit = true;

		// 3ï¸âƒ£ ç‰¹ä¾‹ï¼šè¼¸å…¥ã€Œç¦ã€æ‰¾ 127
		if (!hit && needle === "ç¦" && no === "127") hit = true;

		if (hit){
		  el.classList.add("hit");
		  if (!first) first = el;
		}
	  });

	  if (first){
		first.scrollIntoView({behavior:"smooth", block:"center"});
		// â­ æœå°‹æ™‚ï¼ŒåŒæ­¥é¡¯ç¤ºè©²æ¡Œäººå
		showSeatInfo(first.dataset.no);
	  }else{
		alert("æ‰¾ä¸åˆ°ç¬¦åˆçš„æ¡Œä½æˆ–å§“å");
	  }
	}

  btnSearch.addEventListener("click", applySearch);
  q.addEventListener("keydown", (e)=>{ if(e.key==="Enter") applySearch(); });
  btnReset.addEventListener("click", ()=>{ q.value=""; clearMarks(); });
</script>
</body>
</html>
